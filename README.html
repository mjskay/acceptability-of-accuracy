<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="github-markdown.css" type="text/css" />
</head>
<body>
<h1 id="code-for-how-good-is-85-a-survey-tool-to-connect-classifier-evaluation-to-acceptability-of-accuracy">Code for <em>How good is 85%? A survey tool to connect classifier evaluation to acceptability of accuracy</em></h1>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img
alt="This work is licensed under a Creative Commons Attribution 4.0 International License" 
title="This work is licensed under a Creative Commons Attribution 4.0 International License" 
src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a> <em>Matthew Kay ([mjskay@uw.edu] (mailto:mjskay@uw.edu)), Shwetak N. Patel ([shwetak@uw.edu] (mailto:shwetak@uw.edu)), and Julie A. Kientz ([jkientz@uw.edu] (mailto:jkientz@uw.edu))</em></p>
<p>This repository contains analysis code from:</p>
<p>Kay, Matthew, Patel, Shwetak N., and Kientz, Julie A. How Good is 85%? A Survey Tool to Connect Classifier Evaluation to Acceptability of Accuracy. <em>CHI 2015</em> (upcoming). http://dx.doi.org/10.1145/2702123.2702603</p>
<p>It is intended to allow others to adopt our tool for generating surveys and modelling acceptability of accuracy. It is currently a work-in-progress. If you have any questions, please email Matthew Kay (above). Also, if you've done something cool with this work, we'd love to hear from you!</p>
<h2 id="libraries-needed-for-these-analyses">Libraries needed for these analyses</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(runjags)
<span class="kw">library</span>(tidybayes)
<span class="kw">library</span>(coda)
<span class="kw">library</span>(lme4)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(pander)
<span class="kw">library</span>(GGally)

<span class="kw">memory.limit</span>(<span class="dv">8000</span>)</code></pre>
<pre><code>## [1] 8000</code></pre>
<p>Plus some helper functions in <a href="util.R" class="uri">util.R</a>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="st">&quot;util.R&quot;</span>)</code></pre>
<h2 id="example-model">Example model</h2>
<h3 id="fitting-the-model">Fitting the model</h3>
<p>Example code for fitting a model can be found in <a href="src/application_ui-regression.R" class="uri">src/application_ui-regression.R</a>. Since fitting the model takes some time, for the purposes of this example we will just load the fitted model, which has been saved in <code>src/output/acceptability_ui-model-small-final.RData</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span><span class="st">&quot;output/acceptability_ui-model-stan-final.RData&quot;</span>)
fit =<span class="st"> </span><span class="kw">apply_prototypes</span>(fit, df)</code></pre>
<h3 id="parameter-estimates">Parameter estimates</h3>
<p>Let's plot some posterior parameter estimates. First, we extract the sample estimates for <code>b0</code>, <code>b</code>, <code>p</code>, and <code>alpha</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">params =<span class="st"> </span><span class="kw">extract_samples</span>(fit, <span class="kw">cbind</span>(b, alpha_mu, alpha_v, p)[application])
thresholds =<span class="st"> </span><span class="kw">extract_samples</span>(fit, b0[application,acceptable])
sigmas =<span class="st"> </span><span class="kw">extract_samples</span>(fit, <span class="kw">cbind</span>(sigma_b, sigma_b0)[])</code></pre>
<p>This gives us a pretty simple table of estimates. We can look at the first couple of entries to get an idea of its structure:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(params)</code></pre>
<table>
<thead>
<tr class="header">
<th align="center">.sample</th>
<th align="center">application</th>
<th align="center">alpha_mu</th>
<th align="center">alpha_v</th>
<th align="center">b</th>
<th align="center">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">alarm_police</td>
<td align="center">0.4757</td>
<td align="center">3.678</td>
<td align="center">17.82</td>
<td align="center">0.3606</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">alarm_text_message</td>
<td align="center">0.3576</td>
<td align="center">1.944</td>
<td align="center">18.55</td>
<td align="center">-2.301</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">electricity</td>
<td align="center">0.6023</td>
<td align="center">4.433</td>
<td align="center">15.82</td>
<td align="center">-2.033</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">location</td>
<td align="center">0.5265</td>
<td align="center">1.919</td>
<td align="center">15.69</td>
<td align="center">-2.733</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">alarm_police</td>
<td align="center">0.5009</td>
<td align="center">2.25</td>
<td align="center">16.95</td>
<td align="center">-0.286</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">alarm_text_message</td>
<td align="center">0.4082</td>
<td align="center">1.186</td>
<td align="center">17.59</td>
<td align="center">-1.747</td>
</tr>
</tbody>
</table>
<p>Now we'll plot each parameter in turn, with some useful reference lines:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(params, <span class="kw">aes</span>(<span class="dt">x=</span>application, <span class="dt">y=</span>b)) +
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>)</code></pre>
<div class="figure">
<img src="figure/params_plot-1.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(thresholds, <span class="kw">aes</span>(<span class="dt">x=</span>acceptable, <span class="dt">y=</span>b0)) +
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>) +
<span class="st">    </span><span class="kw">facet_wrap</span>(~application) </code></pre>
<div class="figure">
<img src="figure/params_plot-2.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(params, <span class="kw">aes</span>(<span class="dt">x=</span>application, <span class="dt">y=</span>p)) +
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span>-<span class="dv">1</span>, <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>)</code></pre>
<div class="figure">
<img src="figure/params_plot-3.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(params, <span class="kw">aes</span>(<span class="dt">x=</span>application, <span class="dt">y=</span>alpha_mu)) +
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="fl">0.5</span>, <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>) +
<span class="st">    </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>)</code></pre>
<div class="figure">
<img src="figure/params_plot-4.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(params, <span class="kw">aes</span>(<span class="dt">x=</span>application, <span class="dt">y=</span>alpha_v))</code></pre>
<div class="figure">
<img src="figure/params_plot-5.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">params %&lt;&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">alpha_var =</span> alpha_mu *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>alpha_mu)/(alpha_v +<span class="st"> </span><span class="dv">1</span>))</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): could not find function &quot;%&lt;&gt;%&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(params, <span class="kw">aes</span>(<span class="dt">x=</span>application, <span class="dt">y=</span>alpha_var))</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;alpha_var&#39; not found</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(sigmas, <span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span>sigma_b))</code></pre>
<div class="figure">
<img src="figure/params_plot-6.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(sigmas, <span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span>sigma_b0))</code></pre>
<div class="figure">
<img src="figure/params_plot-7.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggpairs</span>(<span class="kw">log</span>(<span class="kw">cbind</span>(<span class="kw">select</span>(sigmas, -.sample))),
    <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> <span class="st">&quot;density&quot;</span>))</code></pre>
<div class="figure">
<img src="figure/params_plot-8.svg" alt="plot of chunk params_plot" /><p class="caption">plot of chunk params_plot</p>
</div>
<h3 id="differences-in-alpha">Differences in alpha</h3>
<p>We can also examine the posterior difference in alpha between each condition. For every pair of applications, let's get the posterior distribution of their difference in alpha:</p>
<pre class="sourceCode r"><code class="sourceCode r">alpha_comparisons =<span class="st"> </span><span class="kw">compare_levels</span>(params, alpha_mu, <span class="dt">by=</span>application)</code></pre>
<p>Which looks like this:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(alpha_comparisons)</code></pre>
<table>
<thead>
<tr class="header">
<th align="center">.sample</th>
<th align="center">application</th>
<th align="center">alpha_mu</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">alarm_text_message - alarm_police</td>
<td align="center">-0.1181</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">alarm_text_message - alarm_police</td>
<td align="center">-0.09262</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">alarm_text_message - alarm_police</td>
<td align="center">-0.2586</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">alarm_text_message - alarm_police</td>
<td align="center">-0.2536</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">alarm_text_message - alarm_police</td>
<td align="center">-0.05727</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">alarm_text_message - alarm_police</td>
<td align="center">-0.02978</td>
</tr>
</tbody>
</table>
<p>Finally, we can plot the estimated differences:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggposterior</span>(alpha_comparisons, <span class="kw">aes</span>(<span class="dt">x=</span>application, <span class="dt">y=</span>alpha_mu)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>) +
<span class="st">    </span><span class="kw">ylim</span>(-<span class="fl">0.6</span>, <span class="fl">0.6</span>)</code></pre>
<div class="figure">
<img src="figure/alpha_comparison_plot-1.svg" alt="plot of chunk alpha_comparison_plot" /><p class="caption">plot of chunk alpha_comparison_plot</p>
</div>
<h2 id="citing-this-work">Citing this work</h2>
<p>Please cite the CHI paper above.</p>
<h2 id="problems">Problems</h2>
<p>Should you encounter any issues with this code, contact Matthew Kay (<script type="text/javascript">
<!--
h='&#x75;&#x77;&#46;&#x65;&#100;&#x75;';a='&#64;';n='&#x6d;&#106;&#x73;&#x6b;&#x61;&#x79;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#x6d;&#106;&#x73;&#x6b;&#x61;&#x79;&#32;&#x61;&#116;&#32;&#x75;&#x77;&#32;&#100;&#x6f;&#116;&#32;&#x65;&#100;&#x75;</noscript>). If you have found a bug, please file it <a href="https://github.com/mjskay/acceptability-of-accuracy/issues/new">here</a> with minimal code to reproduce the issue.</p>
</body>
</html>
